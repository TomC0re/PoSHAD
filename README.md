# PoSHAD
PoSH-скрипты мониторинга событий AD

## Использование

1. Разместить скрипты в SHARE-ресурс, доступную с домена(ов);
2. Отредактировать, снеся данные SMTP-сервера, аккаунты отправителя (сервиса) и получателя, пароль сервисного аккаунта и порт на котором "слушает" ваш SMTP-сервер:
		$Server = "SMTP_сервер"
		$From = "<Сервисный_аккаунт>"
		$To = "<Адрес_получателя>"
		$pass = ConvertTo-SecureString "<Пароль_сервисного_аккаунта>" -AsPlainText -Force
		$SMTPPort = <port>
3. Зайти на контроллер домена (если у вас их несколько, то поочередно поизвести дальнейшие действия на них всех), в консоле Powershell ввести команду "**Set-ExecutionPolicy Unrestricted**" (разрешаем выполнение всех PoSH-скриптов) или "**Set-ExecutionPolicy RemoteSigned**" (разрешает запуск всех локальных и удаленных PS-файлов с цифровой подписью, кроме запуска по UNC пути). Далее открыть "Планировщик заданий" и настраиваем запуск скрипта в момент, когда нужное событие произошло:
 - Создаем задание, в тригере указываем реагировать на событие **<номер_события>** в журнале "Security"
 - В "Действиях" указываем запуск программы, в поле "Программа или сценарий" пишем "**powershell**", в поле "Добавить аргументы..." пишем "**-nologo -noprofile -File "<Путь_к_директории_со_скриптом>\<Имя_файла>.ps1"**"

## Безопасность

- PowerShell при запуске скрипта создает сессию, в рамках которой хранятся все объекты, переменные. Именно сессия является границей безопасности. Для обеспечения безопасности подписывайте скрипты - в документации по PowerShell есть описание как это сделать.
- Скрипт содержит аккаунты и пароль в открытом виде и поэтому является не безопасным. Для минимизации риска нужно использовать учетные записи для отправки сообщений с минимальным набором прав и дополнительно зашифровать PoSH-скрипт.